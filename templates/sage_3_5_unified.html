<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SAGE 3.5 Unified - Complete Feed</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
        }
        
        /* Sidebar */
        .sidebar {
            width: 280px;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            box-shadow: 2px 0 20px rgba(0,0,0,0.1);
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            left: 0;
            top: 0;
            z-index: 1000;
        }
        
        .logo {
            padding: 30px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            text-align: center;
        }
        
        .logo h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 5px;
        }
        
        .logo p {
            font-size: 12px;
            opacity: 0.9;
        }
        
        .nav-items {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            margin-bottom: 5px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
            color: #4a5568;
        }
        
        .nav-item:hover {
            background: rgba(102, 126, 234, 0.1);
            transform: translateX(5px);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        .nav-item .material-icons {
            margin-right: 12px;
            font-size: 20px;
        }
        
        .nav-item .count {
            margin-left: auto;
            background: rgba(0,0,0,0.1);
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
        }
        
        .nav-item.active .count {
            background: rgba(255,255,255,0.3);
        }
        
        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        /* Header */
        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            display: flex;
            align-items: center;
            gap: 20px;
        }
        
        .search-box {
            flex: 1;
            position: relative;
        }
        
        .search-box input {
            width: 100%;
            padding: 12px 20px 12px 45px;
            border: 2px solid #e2e8f0;
            border-radius: 12px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .search-box input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-box .material-icons {
            position: absolute;
            left: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #a0aec0;
        }
        
        .refresh-btn {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }
        
        /* Feed Container */
        .feed-container {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            display: flex;
            gap: 30px;
        }
        
        /* Feed List */
        .feed-list {
            flex: 1;
            max-width: 800px;
        }
        
        .feed-item {
            background: white;
            border-radius: 16px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .feed-item:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .feed-item.selected {
            border: 2px solid #667eea;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.2);
        }
        
        .feed-header {
            display: flex;
            align-items: center;
            margin-bottom: 12px;
        }
        
        .feed-author {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .author-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
        }
        
        .author-info {
            flex: 1;
        }
        
        .author-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 14px;
        }
        
        .author-handle {
            color: #718096;
            font-size: 12px;
        }
        
        .feed-time {
            color: #a0aec0;
            font-size: 12px;
            margin-left: auto;
        }
        
        .feed-content {
            color: #4a5568;
            line-height: 1.6;
            margin-bottom: 12px;
        }
        
        .feed-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
            font-size: 16px;
        }
        
        .feed-text {
            font-size: 14px;
            color: #4a5568;
            line-height: 1.5;
            max-height: 100px;
            overflow: hidden;
            position: relative;
        }
        
        .feed-text.expanded {
            max-height: none;
        }
        
        /* Media Grid */
        .media-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 12px;
        }
        
        .media-item {
            border-radius: 8px;
            overflow: hidden;
            background: #f7fafc;
            position: relative;
        }
        
        .media-item img {
            width: 100%;
            height: auto;
            display: block;
        }
        
        .media-item .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0,0,0,0.7);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }
        
        /* Feed Actions */
        .feed-actions {
            display: flex;
            gap: 20px;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px solid #e2e8f0;
        }
        
        .feed-action {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #718096;
            font-size: 13px;
        }
        
        .feed-action .material-icons {
            font-size: 18px;
        }
        
        .feed-tags {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }
        
        .tag {
            padding: 4px 10px;
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
        }
        
        /* Detail Panel */
        .detail-panel {
            width: 500px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 2px 20px rgba(0,0,0,0.1);
            padding: 30px;
            overflow-y: auto;
            display: none;
        }
        
        .detail-panel.active {
            display: block;
        }
        
        .detail-header {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 2px solid #e2e8f0;
        }
        
        .detail-title {
            font-size: 20px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 10px;
        }
        
        .detail-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            color: #718096;
            font-size: 13px;
        }
        
        .detail-content {
            color: #4a5568;
            line-height: 1.8;
            font-size: 15px;
        }
        
        .detail-content img {
            max-width: 100%;
            border-radius: 8px;
            margin: 15px 0;
        }
        
        .detail-attachments {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid #e2e8f0;
        }
        
        .attachment-item {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px;
            background: #f7fafc;
            border-radius: 8px;
            margin-bottom: 10px;
        }
        
        .attachment-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
        }
        
        .attachment-info {
            flex: 1;
        }
        
        .attachment-name {
            font-weight: 600;
            color: #2d3748;
            font-size: 14px;
        }
        
        .attachment-size {
            color: #a0aec0;
            font-size: 12px;
        }
        
        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: white;
        }
        
        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Email specific */
        .email-content {
            background: white;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }
        
        .email-iframe {
            width: 100%;
            min-height: 600px;
            border: none;
            border-radius: 8px;
        }
        
        /* Tweet specific */
        .tweet-media {
            margin-top: 15px;
        }
        
        .tweet-stats {
            display: flex;
            gap: 20px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #e2e8f0;
        }
        
        .tweet-stat {
            display: flex;
            align-items: center;
            gap: 5px;
            color: #718096;
        }
        
        .tweet-stat strong {
            color: #2d3748;
        }
        
        /* No data */
        .no-data {
            text-align: center;
            padding: 60px;
            color: white;
        }
        
        .no-data .material-icons {
            font-size: 64px;
            opacity: 0.5;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="logo">
            <h1>SAGE 3.5</h1>
            <p>Unified Enhanced Feed</p>
        </div>
        
        <div class="nav-items">
            <div class="nav-item active" data-filter="all">
                <span class="material-icons">dashboard</span>
                <span>All Items</span>
                <span class="count" id="count-all">0</span>
            </div>
            
            <div class="nav-item" data-filter="email">
                <span class="material-icons">email</span>
                <span>Emails</span>
                <span class="count" id="count-email">0</span>
            </div>
            
            <div class="nav-item" data-filter="twitter">
                <span class="material-icons">tag</span>
                <span>Twitter</span>
                <span class="count" id="count-twitter">0</span>
            </div>
            
            <div class="nav-item" data-filter="financial">
                <span class="material-icons">trending_up</span>
                <span>Financial</span>
                <span class="count" id="count-financial">0</span>
            </div>
            
            <div class="nav-item" data-filter="goldman_sachs">
                <span class="material-icons">business</span>
                <span>Goldman Sachs</span>
                <span class="count" id="count-goldman">0</span>
            </div>
            
            <div class="nav-item" data-filter="media">
                <span class="material-icons">image</span>
                <span>With Media</span>
                <span class="count" id="count-media">0</span>
            </div>
        </div>
    </div>
    
    <!-- Main Content -->
    <div class="main-content">
        <!-- Header -->
        <div class="header">
            <div class="search-box">
                <span class="material-icons">search</span>
                <input type="text" id="search-input" placeholder="Search emails, tweets, authors...">
            </div>
            
            <button class="refresh-btn" onclick="refreshFeed()">
                <span class="material-icons">refresh</span>
                <span>Refresh</span>
            </button>
        </div>
        
        <!-- Feed Container -->
        <div class="feed-container">
            <!-- Feed List -->
            <div class="feed-list" id="feed-list">
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <p>Loading enhanced feed...</p>
                </div>
            </div>
            
            <!-- Detail Panel -->
            <div class="detail-panel" id="detail-panel">
                <!-- Content will be injected here -->
            </div>
        </div>
    </div>
    
    <script>
        let currentFilter = 'all';
        let currentPage = 1;
        let isLoading = false;
        let hasMore = true;
        let selectedItem = null;
        let searchTimeout = null;
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadStats();
            loadFeed();
            setupEventListeners();
            setupInfiniteScroll();
        });
        
        // Setup event listeners
        function setupEventListeners() {
            // Navigation
            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', () => {
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
                    item.classList.add('active');
                    currentFilter = item.dataset.filter;
                    currentPage = 1;
                    hasMore = true;
                    loadFeed(true);
                });
            });
            
            // Search
            document.getElementById('search-input').addEventListener('input', (e) => {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    currentPage = 1;
                    hasMore = true;
                    loadFeed(true);
                }, 300);
            });
        }
        
        // Setup infinite scroll
        function setupInfiniteScroll() {
            const feedList = document.getElementById('feed-list');
            feedList.addEventListener('scroll', () => {
                if (isLoading || !hasMore) return;
                
                const { scrollTop, scrollHeight, clientHeight } = feedList;
                if (scrollTop + clientHeight >= scrollHeight - 100) {
                    loadFeed(false);
                }
            });
        }
        
        // Load statistics
        async function loadStats() {
            try {
                const response = await fetch('/api/stats');
                const stats = await response.json();
                
                document.getElementById('count-all').textContent = stats.total || 0;
                document.getElementById('count-email').textContent = stats.emails || 0;
                document.getElementById('count-twitter').textContent = stats.tweets || 0;
                document.getElementById('count-financial').textContent = stats.financial || 0;
                document.getElementById('count-goldman').textContent = stats.goldman_sachs || 0;
                document.getElementById('count-media').textContent = stats.with_media || 0;
            } catch (error) {
                console.error('Error loading stats:', error);
            }
        }
        
        // Load feed
        async function loadFeed(reset = false) {
            if (isLoading) return;
            isLoading = true;
            
            const feedList = document.getElementById('feed-list');
            const search = document.getElementById('search-input').value;
            
            if (reset) {
                feedList.innerHTML = '<div class="loading"><div class="loading-spinner"></div><p>Loading...</p></div>';
            }
            
            try {
                const params = new URLSearchParams({
                    filter: currentFilter,
                    page: currentPage,
                    per_page: 50,
                    search: search
                });
                
                const response = await fetch(`/api/feed?${params}`);
                const data = await response.json();
                
                if (reset) {
                    feedList.innerHTML = '';
                }
                
                if (data.items.length === 0 && currentPage === 1) {
                    feedList.innerHTML = `
                        <div class="no-data">
                            <span class="material-icons">inbox</span>
                            <h3>No items found</h3>
                            <p>Try adjusting your filters or search</p>
                        </div>
                    `;
                } else {
                    data.items.forEach(item => {
                        feedList.appendChild(createFeedItem(item));
                    });
                }
                
                hasMore = data.has_more;
                currentPage++;
                
            } catch (error) {
                console.error('Error loading feed:', error);
                if (reset) {
                    feedList.innerHTML = `
                        <div class="no-data">
                            <span class="material-icons">error</span>
                            <h3>Error loading feed</h3>
                            <p>${error.message}</p>
                        </div>
                    `;
                }
            } finally {
                isLoading = false;
            }
        }
        
        // Create feed item element
        function createFeedItem(item) {
            const div = document.createElement('div');
            div.className = 'feed-item';
            div.dataset.id = item.id;
            
            // Get author initial
            const initial = (item.author || 'U')[0].toUpperCase();
            
            // Format content based on type
            let content = '';
            if (item.source_type === 'email') {
                content = `
                    <div class="feed-title">${escapeHtml(item.title || 'No subject')}</div>
                    <div class="feed-text">${escapeHtml(item.content_text || '').substring(0, 200)}...</div>
                `;
            } else {
                // Twitter - show full tweet
                content = `<div class="feed-text">${escapeHtml(item.title || item.content_text || '')}</div>`;
            }
            
            // Media preview
            let mediaHtml = '';
            if (item.media_urls && item.media_urls.length > 0) {
                mediaHtml = '<div class="media-grid">';
                item.media_urls.slice(0, 4).forEach(url => {
                    if (url.startsWith('data:')) {
                        // Embedded image
                        mediaHtml += `
                            <div class="media-item">
                                <img src="${url}" alt="Embedded">
                            </div>
                        `;
                    } else {
                        // External media
                        mediaHtml += `
                            <div class="media-item">
                                <img src="${url}" alt="Media">
                            </div>
                        `;
                    }
                });
                mediaHtml += '</div>';
            }
            
            // Tags
            let tagsHtml = '';
            if (item.tags) {
                const tags = item.tags.split(',');
                tagsHtml = '<div class="feed-tags">';
                tags.forEach(tag => {
                    if (tag) {
                        tagsHtml += `<span class="tag">${escapeHtml(tag)}</span>`;
                    }
                });
                tagsHtml += '</div>';
            }
            
            // Actions based on type
            let actionsHtml = '';
            if (item.source_type === 'twitter') {
                actionsHtml = `
                    <div class="feed-actions">
                        <div class="feed-action">
                            <span class="material-icons">repeat</span>
                            <span>${item.retweet_count || 0}</span>
                        </div>
                        <div class="feed-action">
                            <span class="material-icons">favorite</span>
                            <span>${item.like_count || 0}</span>
                        </div>
                        ${item.has_media ? `
                        <div class="feed-action">
                            <span class="material-icons">image</span>
                            <span>${item.media_count}</span>
                        </div>` : ''}
                    </div>
                `;
            } else if (item.has_attachments) {
                actionsHtml = `
                    <div class="feed-actions">
                        <div class="feed-action">
                            <span class="material-icons">attachment</span>
                            <span>${item.attachment_count} attachment${item.attachment_count > 1 ? 's' : ''}</span>
                        </div>
                    </div>
                `;
            }
            
            div.innerHTML = `
                <div class="feed-header">
                    <div class="feed-author">
                        <div class="author-avatar">${initial}</div>
                        <div class="author-info">
                            <div class="author-name">${escapeHtml(item.author || 'Unknown')}</div>
                            ${item.author_handle ? `<div class="author-handle">@${escapeHtml(item.author_handle)}</div>` : ''}
                        </div>
                    </div>
                    <div class="feed-time">${item.formatted_date || ''}</div>
                </div>
                <div class="feed-content">
                    ${content}
                    ${mediaHtml}
                </div>
                ${tagsHtml}
                ${actionsHtml}
            `;
            
            // Click handler
            div.addEventListener('click', () => selectItem(item));
            
            return div;
        }
        
        // Select item and show details
        async function selectItem(item) {
            // Update selection
            document.querySelectorAll('.feed-item').forEach(el => el.classList.remove('selected'));
            document.querySelector(`[data-id="${item.id}"]`)?.classList.add('selected');
            
            selectedItem = item;
            
            // Show detail panel
            const panel = document.getElementById('detail-panel');
            panel.classList.add('active');
            
            // Load full item data
            try {
                const response = await fetch(`/api/item/${item.id}`);
                const fullItem = await response.json();
                
                // Render based on type
                if (fullItem.source_type === 'email') {
                    renderEmailDetail(fullItem);
                } else {
                    renderTweetDetail(fullItem);
                }
            } catch (error) {
                console.error('Error loading item:', error);
                panel.innerHTML = `
                    <div class="no-data">
                        <span class="material-icons">error</span>
                        <h3>Error loading details</h3>
                        <p>${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Render email detail
        function renderEmailDetail(item) {
            const panel = document.getElementById('detail-panel');
            
            // Attachments HTML
            let attachmentsHtml = '';
            if (item.attachments && item.attachments.length > 0) {
                attachmentsHtml = '<div class="detail-attachments"><h3>Attachments</h3>';
                item.attachments.forEach(att => {
                    const icon = att.content_type?.includes('image') ? 'image' : 'attachment';
                    const size = att.size ? `${(att.size / 1024).toFixed(1)} KB` : '';
                    attachmentsHtml += `
                        <div class="attachment-item">
                            <div class="attachment-icon">
                                <span class="material-icons">${icon}</span>
                            </div>
                            <div class="attachment-info">
                                <div class="attachment-name">${escapeHtml(att.filename || 'Attachment')}</div>
                                <div class="attachment-size">${att.content_type || 'Unknown type'} ${size}</div>
                            </div>
                        </div>
                    `;
                });
                attachmentsHtml += '</div>';
            }
            
            panel.innerHTML = `
                <div class="detail-header">
                    <div class="detail-title">${escapeHtml(item.title || 'No subject')}</div>
                    <div class="detail-meta">
                        <span>${escapeHtml(item.author || 'Unknown')}</span>
                        <span>â€¢</span>
                        <span>${item.formatted_date || item.created_at}</span>
                    </div>
                </div>
                <div class="email-content">
                    ${item.content_html ? 
                        `<iframe class="email-iframe" srcdoc="${escapeHtml(item.content_html)}" 
                         sandbox="allow-same-origin allow-popups allow-popups-to-escape-sandbox"></iframe>` :
                        `<div class="detail-content">${escapeHtml(item.content_text || 'No content')}</div>`
                    }
                </div>
                ${attachmentsHtml}
            `;
            
            // Adjust iframe height after load
            const iframe = panel.querySelector('.email-iframe');
            if (iframe) {
                iframe.onload = () => {
                    try {
                        const height = iframe.contentDocument.body.scrollHeight;
                        iframe.style.height = height + 'px';
                    } catch (e) {
                        console.log('Could not adjust iframe height');
                    }
                };
            }
        }
        
        // Render tweet detail
        function renderTweetDetail(item) {
            const panel = document.getElementById('detail-panel');
            
            // Media HTML
            let mediaHtml = '';
            if (item.media_urls && item.media_urls.length > 0) {
                mediaHtml = '<div class="tweet-media">';
                item.media_urls.forEach(url => {
                    mediaHtml += `<img src="${url}" style="width:100%;border-radius:8px;margin-bottom:10px;">`;
                });
                mediaHtml += '</div>';
            }
            
            // URLs HTML
            let urlsHtml = '';
            if (item.urls && item.urls.length > 0) {
                urlsHtml = '<div style="margin-top:15px;">';
                item.urls.forEach(url => {
                    urlsHtml += `<a href="${url}" target="_blank" rel="noopener" style="display:block;color:#667eea;margin-bottom:5px;">${url}</a>`;
                });
                urlsHtml += '</div>';
            }
            
            panel.innerHTML = `
                <div class="detail-header">
                    <div class="feed-author" style="margin-bottom:15px;">
                        <div class="author-avatar">${(item.author || 'U')[0].toUpperCase()}</div>
                        <div class="author-info">
                            <div class="author-name">${escapeHtml(item.author || 'Unknown')}</div>
                            ${item.author_handle ? `<div class="author-handle">@${escapeHtml(item.author_handle)}</div>` : ''}
                        </div>
                    </div>
                    <div class="detail-meta">
                        <span>${item.formatted_date || item.created_at}</span>
                    </div>
                </div>
                <div class="detail-content">
                    ${escapeHtml(item.content_text || item.title || '')}
                    ${mediaHtml}
                    ${urlsHtml}
                </div>
                <div class="tweet-stats">
                    <div class="tweet-stat">
                        <span class="material-icons">repeat</span>
                        <strong>${item.retweet_count || 0}</strong> Retweets
                    </div>
                    <div class="tweet-stat">
                        <span class="material-icons">favorite</span>
                        <strong>${item.like_count || 0}</strong> Likes
                    </div>
                </div>
            `;
        }
        
        // Refresh feed
        function refreshFeed() {
            currentPage = 1;
            hasMore = true;
            loadStats();
            loadFeed(true);
        }
        
        // Escape HTML
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
